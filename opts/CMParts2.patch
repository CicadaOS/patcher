From 6c282adf9d1b7907d528d677c2ceb19b228c292d Mon Sep 17 00:00:00 2001
From: ghbhaha <ghbhaha@gmail.com>
Date: Thu, 6 Oct 2016 21:39:50 +0800
Subject: [PATCH 2/2] CMParts: Network Traffic [2/2]

Change-Id: Ia90b3ad4769b511bf3b0cd83cff07ab37e562819
---
 res/values-zh-rCN/sm_strings.xml                   |  8 ++++++++
 res/values/arrays.xml                              | 15 +++++++++++++++
 res/values/sm_strings.xml                          | 11 +++++++++++
 res/xml/status_bar_settings.xml                    | 11 +++++++++++
 .../cmparts/statusbar/StatusBarSettings.java       | 22 +++++++++++++++++++++-
 5 files changed, 66 insertions(+), 1 deletion(-)

diff --git a/res/values-zh-rCN/sm_strings.xml b/res/values-zh-rCN/sm_strings.xml
index 5793090..f855895 100644
--- a/res/values-zh-rCN/sm_strings.xml
+++ b/res/values-zh-rCN/sm_strings.xml
@@ -36,4 +36,12 @@
     <string name="carrier_size_style_normal">正常</string>
     <string name="carrier_size_style_small">小</string>
     <string name="carrier_size_style_big">大</string>
+    <!-- Show network speed -->
+    <string name="show_network_speed_title">状态栏网速</string>
+    <string name="show_network_speed_summary">在状态栏显示当前网速</string>
+    <string name="status_bar_network_traffic_style_disable">禁用</string>
+    <string name="status_bar_network_traffic_style_up">显示上传速度</string>
+    <string name="status_bar_network_traffic_style_down">显示下载速度</string>
+    <string name="status_bar_network_traffic_style_all">显示上传和下载速度</string>
+
 </resources>
diff --git a/res/values/arrays.xml b/res/values/arrays.xml
index 21af519..c1777a0 100644
--- a/res/values/arrays.xml
+++ b/res/values/arrays.xml
@@ -15,6 +15,21 @@
      limitations under the License.
 -->
 <resources>
+    <!-- show network traffic -->
+    <string-array name="entries_status_bar_network_traffic_style" translatable="false">
+        <item>@string/status_bar_network_traffic_style_disable</item>
+        <item>@string/status_bar_network_traffic_style_up</item>
+        <item>@string/status_bar_network_traffic_style_down</item>
+        <item>@string/status_bar_network_traffic_style_all</item>
+    </string-array>
+
+    <string-array name="values_status_bar_network_traffic_style" translatable="false">
+        <item>0</item>
+        <item>1</item>
+        <item>2</item>
+        <item>3</item>
+    </string-array>
+
     <!-- Values for the notification light pulse spinners -->
     <string-array name="notification_pulse_length_entries" translatable="false">
         <item>@string/pulse_length_always_on</item>
diff --git a/res/values/sm_strings.xml b/res/values/sm_strings.xml
index 75720fa..380a967 100644
--- a/res/values/sm_strings.xml
+++ b/res/values/sm_strings.xml
@@ -38,5 +38,16 @@
     <string name="carrier_size_style_normal">Normal</string>
     <string name="carrier_size_style_small">Small</string>
     <string name="carrier_size_style_big">Big</string>
+    <!-- Show network speed -->
+    <string name="show_network_speed_title">Network speed</string>
+    <string name="show_network_speed_summary">Show network speed in status bar</string>
+    <string name="status_bar_network_traffic_style_disable">Disabled</string>
+    <string name="status_bar_network_traffic_style_up">Outgoing</string>
+    <string name="status_bar_network_traffic_style_down">Incoming</string>
+    <string name="status_bar_network_traffic_style_all">Outgoing and incoming</string>
+    <string name="keyguard_toggle_torch_title">Switch flashlight</string>
+    <string name="keyguard_toggle_torch_summary">Power key switch flashligh</string>
+    <string name="three_finger_gesture_title">Three screenshots</string>
+    <string name="three_finger_gesture_summary">Three finger sliding screen screenshot</string>
 
 </resources>
diff --git a/res/xml/status_bar_settings.xml b/res/xml/status_bar_settings.xml
index c2a5053..3993ef2 100644
--- a/res/xml/status_bar_settings.xml
+++ b/res/xml/status_bar_settings.xml
@@ -27,6 +27,17 @@
         android:entryValues="@array/status_bar_quick_qs_pulldown_values"
         android:defaultValue="0" />
 
+    <PreferenceCategory android:key="show_network_options"
+        android:title="@string/show_network_speed_title">
+
+        <ListPreference android:defaultValue="3"
+            android:dialogTitle="@string/show_network_speed_title"
+            android:entries="@array/entries_status_bar_network_traffic_style"
+            android:entryValues="@array/values_status_bar_network_traffic_style"
+            android:key="status_bar_network_traffic_style"
+            android:title="@string/show_network_speed_title" />
+
+    </PreferenceCategory>
 
     <PreferenceCategory android:key="show_status_carrier_options"
         android:title="@string/show_status_bar_carrier_title">
diff --git a/src/org/cyanogenmod/cmparts/statusbar/StatusBarSettings.java b/src/org/cyanogenmod/cmparts/statusbar/StatusBarSettings.java
index 50acc93..1924c02 100644
--- a/src/org/cyanogenmod/cmparts/statusbar/StatusBarSettings.java
+++ b/src/org/cyanogenmod/cmparts/statusbar/StatusBarSettings.java
@@ -54,6 +54,7 @@ public class StatusBarSettings extends SettingsPreferenceFragment
     private static final String STATUS_BAR_CARRIER = "status_bar_carrier";
     private static final String CUSTOM_CARRIER_LABEL = "custom_carrier_label";
     private static final String CARRIER_SIZE_STYLE = "carrier_size_style";
+    private static final String STATUS_BAR_NETWORK_TRAFFIC_STYLE = "status_bar_network_traffic_style";
 
     private static final int STATUS_BAR_BATTERY_STYLE_HIDDEN = 4;
     private static final int STATUS_BAR_BATTERY_STYLE_TEXT = 6;
@@ -72,6 +73,8 @@ public class StatusBarSettings extends SettingsPreferenceFragment
     private ListPreference mCarrierSize;
     private String mCustomCarrierLabelText;
 
+    private ListPreference mStatusBarNetworkTraffic;
+
     @Override
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
@@ -120,6 +123,14 @@ public class StatusBarSettings extends SettingsPreferenceFragment
         } else {
             updateCustomLabelTextSummary();
         }
+
+        mStatusBarNetworkTraffic = (ListPreference) findPreference(STATUS_BAR_NETWORK_TRAFFIC_STYLE);
+        int networkTrafficStyle = Settings.System.getInt(resolver,
+                Settings.System.STATUS_BAR_NETWORK_TRAFFIC_STYLE, 3);
+        mStatusBarNetworkTraffic.setValue(String.valueOf(networkTrafficStyle));
+        mStatusBarNetworkTraffic
+                .setSummary(mStatusBarNetworkTraffic.getEntry());
+        mStatusBarNetworkTraffic.setOnPreferenceChangeListener(this);
     }
 
     @Override
@@ -158,7 +169,16 @@ public class StatusBarSettings extends SettingsPreferenceFragment
             Intent i = new Intent();
             i.setAction(Intent.ACTION_CUSTOM_CARRIER_LABEL_CHANGED);
             getActivity().sendBroadcast(i);
-
+        } else if (preference == mStatusBarNetworkTraffic) {
+            String newValue = (String) objValue;
+            int networkTrafficStyle = Integer.valueOf((String) newValue);
+            int index = mStatusBarNetworkTraffic
+                    .findIndexOfValue((String) newValue);
+            Settings.System.putInt(getContentResolver(),
+                    Settings.System.STATUS_BAR_NETWORK_TRAFFIC_STYLE,
+                    networkTrafficStyle);
+            mStatusBarNetworkTraffic.setSummary(mStatusBarNetworkTraffic
+                    .getEntries()[index]);
         }
         return true;
     }
-- 
2.13.2

