From 364a5d3941766f0552e093f01f0ef65f5420561a Mon Sep 17 00:00:00 2001
From: "Kevin F. Haggerty" <haggertk@lineageos.org>
Date: Sat, 25 Aug 2018 20:23:19 -0600
Subject: [PATCH 33/45] soong_config: Allow extension of valid gralloc 1.0
 buffer usage bits

* fw/native change I7f4174581e24e361577640b9263514a168ed482d
  implemented validation of the buffer description info prior to
  creating the descriptor. Some of our devices need to whitelist
  additional usage bits to support camera functionality.
* The TARGET_ADDITIONAL_GRALLOC_10_USAGE_BITS variable can contain
  a singular roll-up value (e.g., 0x02000000U), a left-shifted bit
  (e.g., (1 << 25)), a bitwise OR of these things, or essentially
  anything that the compiler can choke down.

Change-Id: I2127d33b03426b5e0f981aae837e07d82163fa17
---
 core/soong_config.mk | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/core/soong_config.mk b/core/soong_config.mk
index baafb8a..db6b8be 100644
--- a/core/soong_config.mk
+++ b/core/soong_config.mk
@@ -102,6 +102,11 @@ $(call add_json_bool, NativeCoverage,                    $(filter true,$(NATIVE_
 $(call add_json_list, CoveragePaths,                     $(COVERAGE_PATHS))
 $(call add_json_list, CoverageExcludePaths,              $(COVERAGE_EXCLUDE_PATHS))
 
+ifeq ($(TARGET_ADDITIONAL_GRALLOC_10_USAGE_BITS),)
+  $(call add_json_str, Additional_gralloc_10_usage_bits, 0)
+else
+  $(call add_json_str, Additional_gralloc_10_usage_bits, $(TARGET_ADDITIONAL_GRALLOC_10_USAGE_BITS))
+endif
 $(call add_json_bool, Has_legacy_camera_hal1,            $(filter true,$(if $(filter true,$(TARGET_HAS_LEGACY_CAMERA_HAL1)),true,false)))
 $(call add_json_str,  Target_shim_libs,                  $(subst $(space),:,$(TARGET_LD_SHIM_LIBS)))
 $(call add_json_bool, Uses_media_extensions,             $(filter true,$(if $(filter true,$(TARGET_USES_MEDIA_EXTENSIONS)),true,false)))
-- 
2.7.4

