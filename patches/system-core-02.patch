From c2e19442c1e7ab922b671d0ed3129c92ffe595b0 Mon Sep 17 00:00:00 2001
From: spooja <spooja@codeaurora.org>
Date: Fri, 23 Jun 2017 14:39:20 +0530
Subject: [PATCH 2/2] Increase logcat buffer size to 4M for userdebug and engg
 builds

Change-Id: I70ba03ee59cbfe28041d57b895b3be2bbac220ab
---
 logd/LogBuffer.cpp | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/logd/LogBuffer.cpp b/logd/LogBuffer.cpp
index 749832530..548a9da52 100644
--- a/logd/LogBuffer.cpp
+++ b/logd/LogBuffer.cpp
@@ -50,8 +50,14 @@ void LogBuffer::init() {
         mLastSet[i] = false;
         mLast[i] = mLogElements.begin();
 
-        if (setSize(i, __android_logger_get_buffer_size(i))) {
-            setSize(i, LOG_BUFFER_MIN_SIZE);
+        char value[PROPERTY_VALUE_MAX];
+        property_get("ro.build.type", value, "user");
+        if ((0 == strcmp(value, "userdebug") ||
+            0 == strcmp(value, "eng")) &&
+            !(__android_logger_property_get_bool("ro.config.low_ram",BOOL_DEFAULT_FALSE))){
+                setSize(i, (4 * 1024 * 1024UL));
+        } else if (setSize(i, __android_logger_get_buffer_size(i))) {
+               setSize(i, LOG_BUFFER_MIN_SIZE);
         }
     }
     bool lastMonotonic = monotonic;
-- 
2.11.0.windows.1

